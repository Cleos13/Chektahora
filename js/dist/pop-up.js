let stock_2 = [
  {
    name: "blackKit",
    id: 1,
    cant: 1,
    price: 4960,
    cat: "its",
    img: "css/img/pruebas/black.png",
    description: "Conoce este kit en el menú ITS",
  },
  {
    name: "VPH Kit",
    id: 2,
    cant: 1,
    price: 2500,
    cat: "its",
    img: "css/img/pruebas/vph.png",
    description: "Detecta genotipos de alto y bajo riesgo",
  },
  {
    name: "PCR Kit",
    id: 3,
    cant: 1,
    price: 1100,
    cat: "covid",
    img: "css/img/pruebas/pcr.png",
    description: "Resultados en 18 hrs hábiles",
  },
  {
    name: "Anticuerpos Kit",
    id: 4,
    cant: 1,
    price: 1050,
    cat: "covid",
    img: "css/img/pruebas/anticuerpos.png",
    description: "Resultados en 48 horas hábiles",
  },
  {
    name: "Kit Gold",
    id: 5,
    cant: 1,
    price: 2600,
    cat: "its",
    img: "css/img/pruebas/gold.png",
    description: "Detecta hasta 4 ITS",
  },
  {
    name: "Kit Platinum",
    id: 6,
    cant: 1,
    price: 3200,
    cat: "its",
    img: "css/img/pruebas/platinum.png",
    description: "Detecta hasta 12 ITS",
  },
  {
    name: "Antigenos",
    id: 7,
    cant: 1,
    price: 600,
    cat: "covid",
    img: "css/img/pruebas/antigenos.png",
    description: "Resultados en 20 minutos (verbalmente)",
  },
  {
    name: "Influenza + covid",
    id: 8,
    cant: 1,
    price: 2650,
    cat: "covid",
    img: "css/img/pruebas/influenza-covid.png",
    description: "Resultados en 24 horas hábiles",
  },
  {
    name: "Visita domiciliaria",
    id: 9,
    cant: 1,
    price: 300,
    cat: "its",
    img: "css/img/pruebas/1.png",
    description:
      "Visita domiciliaria de una enfermera para tu toma de muestra sanguínea",
  },
  {
    name: "Quimica sanguínea de 32 elementos",
    id: 10,
    cant: 1,
    price: 1085,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/32-elementos.webp",
    description: "",
  },
  {
    name: "Perfil Hepático",
    id: 11,
    cant: 1,
    price: 575,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/perfil-hepatico.webp",
    description: "",
  },
  {
    name: "Perfil de lípidos",
    id: 12,
    cant: 1,
    price: 405,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/lipidos.webp",
    description: "",
  },
  {
    name: "Perfil pancreático",
    id: 13,
    cant: 1,
    price: 405,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/pancreatico.webp",
    description: "",
  },
  {
    name: "Perfil enzimas cardíaco",
    id: 14,
    cant: 1,
    price: 405,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/enzimas.webp",
    description: "",
  },
  {
    name: "Depuración de creatinina",
    id: 15,
    cant: 1,
    price: 330,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/creatinina.webp",
    description: "",
  },
  {
    name: "Depuración de urea",
    id: 16,
    cant: 1,
    price: 330,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/urea.webp",
    description: "",
  },
  {
    name: "Perfil prenatal I",
    id: 17,
    cant: 1,
    price: 535,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/prenatal-1.webp",
    description: "",
  },
  {
    name: "Perfil prenatal II",
    id: 18,
    cant: 1,
    price: 665,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/prenatal-2.webp",
    description: "",
  },
  {
    name: "Perfil prenatal III",
    id: 19,
    cant: 1,
    price: 925,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/prenatal-3.webp",
    description: "",
  },
  {
    name: "Perfil prenatal IV",
    id: 20,
    cant: 1,
    price: 1105,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/prenatal-4.webp",
    description: "",
  },
  {
    name: "Check-up básico",
    id: 21,
    cant: 1,
    price: 620,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/checkup-basico.webp",
    description: "",
  },
  {
    name: "Check-up completo",
    id: 22,
    cant: 1,
    price: 1275,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/checkup-completo.webp",
    description: "",
  },
  {
    name: "Perfil de drogas 3 analitos",
    id: 23,
    cant: 1,
    price: 475,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/perfil-3-analitos.webp",
    description: "",
  },
  {
    name: "Perfil de drogas 5 analitos",
    id: 24,
    cant: 1,
    price: 525,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/perfil-5-analitos.webp",
    description: "",
  },
  {
    name: "Quimica sanguínea de 3 elementos",
    id: 25,
    cant: 1,
    price: 350,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/3-elementos.webp",
    description: "",
  },
  {
    name: "Quimica sanguínea de 3 elementos modificada",
    id: 26,
    cant: 1,
    price: 375,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/3-elementos-modificada.webp",
    description: "",
  },
  {
    name: "Quimica sanguínea de 6 elementos",
    id: 27,
    cant: 1,
    price: 595,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/6-elementos.webp",
    description: "",
  },
  {
    name: "Quimica sanguínea de 15 elementos",
    id: 28,
    cant: 1,
    price: 715,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/15-elementos.webp",
    description: "",
  },
  {
    name: "EGO",
    id: 29,
    cant: 1,
    price: 320,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/ego.webp",
    description: "",
  },
  {
    name: "TP",
    id: 30,
    cant: 1,
    price: 425,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/tp.webp",
    description: "",
  },
  {
    name: "TPT",
    id: 31,
    cant: 1,
    price: 425,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/tpt.webp",
    description: "",
  },
  {
    name: "Perfil tiroideo",
    id: 32,
    cant: 1,
    price: 755,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/perfil-tiroideo.webp",
    description: "",
  },
  {
    name: "Grupo sanguineos",
    id: 33,
    cant: 1,
    price: 320,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/grupo-sanguineo.webp",
    description: "",
  },
  {
    name: "Marcadores tumorales (AFP, CA125, ACE, CA153)",
    id: 34,
    cant: 1,
    price: 1625,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/marcadores-tumorales.webp",
    description: "",
  },
  {
    name: "Antígeno de próstata (PSA)",
    id: 35,
    cant: 1,
    price: 675,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/antigeno-prostata.webp",
    description: "",
  },
  {
    name: "Insulina",
    id: 36,
    cant: 1,
    price: 435,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/insulina.webp",
    description: "",
  },
  {
    name: "Urocultivo",
    id: 37,
    cant: 1,
    price: 645,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/urocultivo.webp",
    description: "",
  },
  {
    name: "Perfil hormonal",
    id: 38,
    cant: 1,
    price: 905,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/perfil-hormonal.webp",
    description: "",
  },
  {
    name: "Prueba de embarazo",
    id: 39,
    cant: 1,
    price: 310,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/embarazo.webp",
    description: "",
  },
  {
    name: "Hemoglobina glicosilada",
    id: 40,
    cant: 1,
    price: 615,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/hemoglobina.webp",
    description: "",
  },
  {
    name: "Electrocardiograma de reposo",
    id: 41,
    cant: 1,
    price: 2025,
    cat: "clinicos",
    img: "css/img/pruebas/clinicos/electro.webp",
    description: "",
  },
];
let cart_2 = [];
if (!JSON.parse(localStorage.getItem("stock"))) {
  localStorage.setItem("stock", JSON.stringify(stock_2));
  localStorage.setItem("cart", JSON.stringify(cart_2));
}
function updatePop() {
  let finalCart = JSON.parse(localStorage.getItem("cart"));
  localStorage.getItem("card");
  var num = 0;
  var totalProducts = 0;

  let results = finalCart.map((item) => {
    if (item) {
      num += item.cant;
      totalProducts += item.price * item.cant;
      return `<span class="grid-x large-12 py-3 px-3" item="${item.id}"><div class="large-2 px-1"><div class="text-center"><img src="../${item.img}" alt="" class="w-75 rounded-3"></div></div><div class="large-4 fs-6 fw-bold flex-center px-1"><a class="text-morado" style="display:flex; align-items: center;" href="product?u_ref=${item.id}">${item.name}</a></div><div class="large-3 flex-center"><div class="grid-x px-0"><div class="large-4 px-0 flex-center"><button class="btn fs-5" onclick="deleteProduct(${item.id})">-</button></div><div class="large-4 d-flex align-height-center"><input type="text" class="form-control bg-transparent border text-center border-dark text-dark" disabled space="cant-${item.id}" placeholder="${item.cant}" value="${item.cant}"></div><div class="large-4 px-0 flex-center"><button class="btn fs-5" onclick="addProduct(${item.id})">+</button></div></div></div><div class="large-2 fs-1 d-flex align-height-center justify-content-center" space="total-${item.id}">$ ${item.price * item.cant} MXN</div><div class="large-1 flex-center"><button class="btn fs-4 fw-bold" onclick="deleteItem(${item.id})"><img class="cerrar" alt="cerrar" src="../css/img/iconos/cerrar.png"/></button></div></span>`;
    }
  });
  $('[space="num-products"]').html(num);
  if (results.length != 0) {
    $("#space-total").removeClass("display-none");
    $("#total-parcial").html("Total $" + totalProducts + " MXN");
    $("#list-products").html(results);
  } else {
    $("#space-total").addClass("display-none");
    $("#list-products").html(
      '<div class="py-3 text-center">No tienes ningun producto agregado</div>'
    );
  }
}
$("[plus-cart]").on("click", function () {
  addProduct($(this).attr("plus-cart"));
});
$("#close-pop-up").click(function () {
  $("#pop-up").addClass("display-none");
});
$('[space="button-cart"]').click(function (e) {
  e.preventDefault();
  if (window.innerWidth < 768) {
    window.location.href = "detalle-compra";
  } else {
    $("#pop-up").removeClass("display-none");
  }
});

function addProduct(id) {
  var id = parseInt(id);
  cart_2 = JSON.parse(localStorage.getItem("cart"));
  stock_2 = JSON.parse(localStorage.getItem("stock"));
  if (window.innerWidth < 768) {
    $("#message-add-product").fadeIn();
    setTimeout(function () {
      $("#message-add-product").fadeOut(300);
    }, 2000);
  } else {
    $("#pop-up").removeClass("display-none");
  }
  if (cart_2.length === 0) {
    let result = stock_2.filter((item) => {
      return id === item["id"];
    });
    result.cant = result.cant + 1;
    localStorage.setItem("cart", JSON.stringify(result));
    updatePop();
  } else {
    let chkCart = cart_2.some((item) => {
      return id === item.id;
    });
    if (chkCart) {
      let result = cart_2.filter((item) => {
        return id === item["id"];
      });
      result[0].cant = parseInt(result[0].cant) + 1;
      localStorage.setItem("cart", JSON.stringify(cart_2));
      updatePop();
    } else {
      // no estaba en el carro de compra
      let result = stock_2.filter((item) => {
        return id === item["id"];
      });
      result[0].cant = 1;
      cart_2.push(result[0]);
      localStorage.setItem("cart", JSON.stringify(cart_2));
      updatePop();
    }
  }
}

function deleteProduct(id) {
  let cart = JSON.parse(localStorage.getItem("cart"));
  let result = cart.filter((item) => {
    return id === item.id;
  });
  result[0].cant = result[0].cant - 1;
  localStorage.setItem("cart", JSON.stringify(cart));
  if (result[0].cant == 0) {
    deleteItem(id);
  } else {
    updatePop();
  }
}

function deleteItem(id) {
  let cart = JSON.parse(localStorage.getItem("cart"));
  let index = cart.findIndex((index) => index.id === id);
  if (index >= 0) {
    cart.splice(index, 1);
  }
  localStorage.setItem("cart", JSON.stringify(cart));
  var products = JSON.parse(localStorage.getItem("cart"));
  if (products.length == 0) {
    $('[space="num-products"]').html(0);
    $("#space-total").addClass("display-none");
    $("#list-products").html(
      '<div class="py-3 text-center">No tienes ningun producto agregado</div>'
    );
  } else {
    updatePop();
  }
}
updatePop();
$('[action="add-card"]').on("click", function () {
  updatePop();
});